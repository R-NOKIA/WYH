<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>电子玫瑰</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
}

#shusheng {
    position: absolute;
    width: 100%;
    height: 100%;
    text-align: center;
}

#hint {
    position: absolute;
    top: 45%;
    width: 100%;
    text-align: center;
    color: #f2f2f2;
    font-family: "Songti SC", "SimSun", serif;
    letter-spacing: 2px;
    opacity: 1;
    transition: opacity 1.5s ease;
    z-index: 10;
}

#hint .tap {
    margin-top: 12px;
    font-size: 14px;
    opacity: 0.7;
}
</style>
</head>

<body>

<div id="hint">
    <p>来自远方的一束电子玫瑰</p>
    <p class="tap">轻触屏幕</p>
</div>

<audio id="bgm" loop>
    <source src="rose.mp3" type="audio/mpeg">
</audio>

<div id="shusheng">
    <canvas id="c"></canvas>
</div>

<script>
var c = document.getElementById('c');
var a = c.getContext('2d');
var m = Math;
var C = m.cos, S = m.sin, P = m.pow, R = m.random;

c.width = c.height = f = 500;
h = -250;

function p(a, b, c) {
    if (c > 60)
        return [
            S(a * 7) * (13 + 5 / (.2 + P(b * 4, 4))) - S(b) * 50,
            b * f + 50,
            625 + C(a * 7) * (13 + 5 / (.2 + P(b * 4, 4))) + b * 400,
            a * 1 - b / 2,
            a
        ];
    A = a * 2 - 1;
    B = b * 2 - 1;
    if (A * A + B * B < 1) {
        if (c > 37) {
            n = (j = c & 1) ? 6 : 4;
            o = .5 / (a + .01) + C(b * 125) * 3 - a * 300;
            w = b * h;
            return [
                o * C(n) + w * S(n) + j * 610 - 390,
                o * S(n) - w * C(n) + 550 - j * 350,
                1180 + C(B + A) * 99 - j * 300,
                .4 - a * .1 + P(1 - B * B, -h * 6) * .15 - a * b * .4 + C(a + b) / 5,
                o / 1e3 + .7
            ];
        }
        if (c > 32) {
            c = c * 1.16 - .15;
            o = a * 45 - 20;
            w = b * b * h;
            z = o * S(c) + w * C(c) + 620;
            return [
                o * C(c) - w * S(c),
                28 + C(B * .5) * 99 - b * b * b * 60 - z / 2 - h,
                z,
                (b * b * .3 + .3) * b,
                b * .7
            ];
        }
        o = A * (2 - b) * (80 - c * 2);
        w = 99 - C(A) * 120 - C(b) * (-h - c * 4.9) + c * 2;
        z = o * S(c) + w * C(c) + 700;
        return [
            o * C(c) - w * S(c),
            B * 99 - c / 3 - z / 1.35 + 450,
            z,
            (1 - b / 1.2) * .9 + a * .1,
            P((1 - b), 20) / 4 + .05
        ];
    }
}

var started = false;
var buffer = [];

function drawRose() {
    for (i = 0; i < 300; i++) {
        if (s = p(R(), R(), i % 46 / .74)) {
            z = s[2];
            x = ~~(s[0] * f / z - h);
            y = ~~(s[1] * f / z - h);
            q = y * f + x;
            if (!buffer[q] || buffer[q] > z) {
                buffer[q] = z;
                a.fillStyle = "rgb(" + ~(s[3] * h) + "," + ~(s[4] * h) + "," + ~(s[3] * s[3] * -80) + ")";
                a.fillRect(x, y, 1, 1);
            }
        }
    }
}

document.body.addEventListener('click', function () {
    if (started) return;
    started = true;

    document.getElementById('hint').style.opacity = 0;
    document.getElementById('bgm').play();

    setInterval(drawRose, 16);
}, { once: true });
</script>

</body>
</html>
